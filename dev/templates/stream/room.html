<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØºØ±ÙØ© Ø§Ù„Ø¨Ø« - {{ room_name }}</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      direction: rtl;
      font-family: sans-serif;
    }
    #jitsi-container {
      width: 100%;
      height: 100vh;
    }
    .invite-box {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      z-index: 1000;
    }
    .requests-box {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: white;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      border-radius: 10px;
      z-index: 1000;
    }
    .requests-box h5 {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

<!-- Ø¨Ø« Jitsi -->
<div id="jitsi-container"></div>

<!-- âœ… Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© (Ù„Ù„Ù…Ø¶ÙŠÙ ÙÙ‚Ø·) -->
{% if is_owner %}
<div class="invite-box">
  <strong>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©:</strong><br>
  <input type="text" class="form-control" value="{{ request.build_absolute_uri|cut:'room' }}lobby/{{ room_name }}/" readonly>
</div>
{% endif %}

<!-- âœ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© -->
{% if is_owner and pending_requests %}
<div class="requests-box">
  <h5>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h5>
  {% for req in pending_requests %}
    <div class="d-flex justify-content-between align-items-center mb-2">
      <span>{{ req.name }}</span>
      <div>
        <form method="post" action="{% url 'handle_join_request' room_name=room_name %}" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="action" value="approve">
          <input type="hidden" name="name" value="{{ req.name }}">
          <button type="submit" class="btn btn-sm btn-success">Ù‚Ø¨ÙˆÙ„</button>
        </form>
        <form method="post" action="{% url 'handle_join_request' room_name=room_name %}" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="action" value="reject">
          <input type="hidden" name="name" value="{{ req.name }}">
          <button type="submit" class="btn btn-sm btn-danger">Ø±ÙØ¶</button>
        </form>
      </div>
    </div>
  {% empty %}
    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ©</p>
  {% endfor %}
</div>
{% endif %}

<!-- âœ… ØªØ¶Ù…ÙŠÙ† Jitsi -->
<script src="https://meet.jit.si/external_api.js"></script>
<script>
  const isOwner = {{ is_owner|yesno:"true,false" }};
  const domain = "meet.jit.si";
  const options = {
    roomName: "{{ room_name }}",
    parentNode: document.querySelector('#jitsi-container'),
    userInfo: {
      displayName: localStorage.getItem("username") || "Ù…Ø´Ø§Ø±Ùƒ"
    },
    configOverwrite: {
      disableDeepLinking: true
    }
  };
  const api = new JitsiMeetExternalAPI(domain, options);

  if (isOwner) {
    console.log("âœ… Ø§Ù„Ù…Ø¶ÙŠÙ Ø¯Ø§Ø®Ù„ Ø§Ù„ØºØ±ÙØ©");
  } else {
    console.log("ğŸ‘¤ Ø¶ÙŠÙ Ø¯Ø§Ø®Ù„ Ø§Ù„ØºØ±ÙØ©");
  }
</script>

</body>
</html>
